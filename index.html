document.getElementById('memberForm').addEventListener('submit', async function (e) {
  e.preventDefault();

  if (!adminMode) {
    alert('Admin access required to save members.');
    return;
  }

  const name = document.getElementById('name').value;
  const deposit = parseFloat(document.getElementById('deposit').value) || 0;
  const loan = parseFloat(document.getElementById('loan').value) || 0;
  const imageFile = document.getElementById('imageFile').files[0];
  const imageUrlInput = document.getElementById('imageUrl').value;
  let photoId = null;
  let imageUrl = imageUrlInput;

  try {
    // Upload photo if file is selected
    if (imageFile) {
      const uploadedFile = await storage.createFile(BUCKET_ID, ID.unique(), imageFile);
      photoId = uploadedFile.$id;
      imageUrl = `https://cloud.appwrite.io/v1/storage/buckets/${BUCKET_ID}/files/${photoId}/view?project=${client.config.project}`;
    }

    // Save data to Appwrite Database
    await databases.createDocument(DATABASE_ID, COLLECTION_ID, ID.unique(), {
      name,
      deposit,
      loan,
      photo: photoId || imageUrl
    });

    alert("✅ Member saved to Appwrite!");
    closeModal(); // close modal
    renderMembers(); // refresh UI
  } catch (error) {
    console.error(error);
    alert("❌ Error saving member: " + error.message);
  }
});
